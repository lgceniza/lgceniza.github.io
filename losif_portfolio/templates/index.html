<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pullen's Portfolio â€“ my different various works of art</title>
    <link rel="stylesheet" href="{{ url_for('static', filename= 'css/style.css') }}">
</head>
<body onload="populateGallery()">
    <!-- logo, header, and socials container -->
    <div>
        <!-- left division -->
        <div>
            <span onclick="showOrHideCategory()" class="navLogo">
                LOGO
                <!-- <img src="logo.png"> -->
            </span>
            <span>
                Pullen's Portfolio
            </span>
        </div>
        <!-- right division -->
        <div>
            <a href="https://twitter.com/_Losif_">twitter</a>
            <a href="https://www.instagram.com/losiflg/">instagram</a>
        </div>
    </div>
    <!-- category container -->
    <div id="categoryContainer" class="categoryNav">
        <div>
            <span onclick="showOrHideCategory()" class="navLogo">
                LOGO
                <!-- <img src="logo.png"> -->
            </span>
            <span>
                Pullen's Portfolio
            </span>
        </div>
        <ul id="navList"></ul>
    </div>
    <div id="gallery">
        <!-- modal images, responsive image grid, carousel in modal (lightbox) -->

        <div id="galleryModal" class="modal">
            <img id="modalImg" class="modal-content">
        </div>
    </div>
</body>
<script>
    const gallery = document.getElementById('gallery')
    const modal = document.getElementById('galleryModal')
    const modalImage = document.getElementById('modalImg')
    const sidebarWidth = "300px";
    const sidebar = document.getElementById('categoryContainer')

    const categoryJson = fetch("{{ url_for('static', filename='category.json') }}")
        .then(res => res.json())
        .then(content => {return content})


    function populateNavList() {
        const navList = document.getElementById('navList')
        navList.innerHTML = ''

        categoryJson.then(ls => {
            ls['categoryList'].forEach(category => {
                const navItem = document.createElement('li')
                navItem.innerText = category['categoryName']
                navItem.onclick = function () {
                    document.getElementById(category['categoryId']).scrollIntoView({"behavior": "smooth"})
                    showOrHideCategory()
                }
                navItem.setAttribute('class', 'navItem')
                navList.appendChild(navItem)
            })
        })
    }

    function populateGallery() {
        categoryJson.then(ls => {
            ls['categoryList'].forEach(category => {
                const categoryDiv = document.createElement('div')
                const nameIdCard = document.createElement('div')
                nameIdCard.id = category['categoryId']
                nameIdCard.innerText = category['categoryName']
                categoryDiv.appendChild(nameIdCard)

                category['images'].forEach(image => {
                    const imgNode = document.createElement('img')

                    imgNode.setAttribute('id', image['imageId'])
                    imgNode.src = `/static/${image["src"]}`
                    imgNode.setAttribute('class', "galleryItem")
                    imgNode.setAttribute('onclick', "showImg(this.id)")

                    categoryDiv.appendChild(imgNode)
                })
                gallery.insertBefore(categoryDiv, modal)
            })
        })
    }

    function showOrHideCategory() {
        if (sidebar.style.width == sidebarWidth) {
            sidebar.style.width = 0;
        } else {
            sidebar.style.width = sidebarWidth;

            populateNavList();
        }
    }

    function showImg(id) {
        const img = document.getElementById(id);
        modal.style.display = "block";
        modalImage.src = img.src;
    }

    function slideImage(index) {
        return
    }

    document.addEventListener('click', function clickOutsideSidebar(event) {
        if (sidebar.style.width == sidebarWidth && !sidebar.contains(event.target) && gallery.contains(event.target)) {
            showOrHideCategory()
        }
    })

    document.addEventListener('click', function clickOutsideModalImage(event) {
        if (modal.contains(event.target) && !modalImage.contains(event.target)) {
            modal.style.display = "none"
            modalImage.removeAttribute('src')
        }
    })
</script>
</html>